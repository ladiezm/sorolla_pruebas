<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="text-center">
    <body class="text-center">
        <div class="container mt-5">
            <h2>Escanea un Código QR</h2>
            <div id="reader" style="width: 100%; max-width: 400px; margin: auto;"></div>
            <p id="result" class="mt-3"></p>
            <button onclick="stopScanner()" class="btn btn-danger">Detener</button>
            <a href="index.html" class="btn btn-secondary mt-3">Volver</a>
        </div>
    
        <script>
            let scanner;
    
            function startScanner() {
                scanner = new Html5Qrcode("reader");
    
                Html5Qrcode.getCameras().then(devices => {
                    if (devices && devices.length) {
                        let cameraId = devices[0].id; // Seleccionamos la primera cámara disponible
    
                        scanner.start(
                            cameraId, // Activamos la cámara trasera
                            {
                                fps: 10,
                                qrbox: { width: 250, height: 250 },
                            },
                            (decodedText) => {
                                document.getElementById("result").innerText = "Código QR: " + decodedText;
                                stopScanner(); // Detenemos el escaneo tras leer el código
                            },
                            (error) => {
                                console.log("Error de escaneo:", error);
                            }
                        ).catch(err => {
                            console.error("Error al iniciar la cámara:", err);
                        });
                    } else {
                        alert("No se encontraron cámaras disponibles.");
                    }
                }).catch(err => {
                    console.error("Error obteniendo cámaras:", err);
                });
            }
    
            function stopScanner() {
                if (scanner) {
                    scanner.stop().then(() => {
                        console.log("Escáner detenido");
                    }).catch(err => {
                        console.error("Error al detener el escáner:", err);
                    });
                }
            }
    
            // Iniciar el escáner automáticamente al cargar la página
            window.onload = startScanner;
        </script>
</body>
</html>